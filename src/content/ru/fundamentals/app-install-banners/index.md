project_path: /web/fundamentals/_project.yaml book_path: /web/fundamentals/_book.yaml description: Добавить на домашний экран позволяет пользователям быстро и без проблем добавлять ваше веб-приложение на свои домашние экраны, не выходя из браузера.

{# wf_updated_on: 2019-03-19 #} {# wf_published_on: 2014-12-16 #} {# wf_blink_components: платформа> Приложения> AppLauncher> Install #}

# Добавить на главный экран {: .page-title}

{% include "web / _shared / contributors / petelepage.html"%}

**Функция «Добавить на главный экран»** , иногда называемая приглашением к установке веб-приложения, позволяет пользователям легко устанавливать ваш Progressive Web App на свое мобильное или [настольное устройство](/web/progressive-web-apps/desktop) . После того, как пользователь примет приглашение, ваш PWA будет добавлен в его панель запуска и будет работать как любое другое установленное приложение.

Chrome справляется с большинством тяжелых работ для вас:

- На мобильных устройствах Chrome создаст [WebAPK](/web/fundamentals/integration/webapks) , создавая еще более интегрированный интерфейс для ваших пользователей.
- На рабочем столе ваше приложение будет установлено и запущено в [окне приложения](/web/progressive-web-apps/desktop#app-window) .

## Каковы критерии? {: # критерии}

{% include "web / basicstals / app-install-banner / _a2hs-crit.html"%}

Примечание. Если манифест веб-приложения включает в себя <code>related_applications</code> и имеет параметр <code>"prefer_related_applications": true</code> , вместо этого будет отображаться <a href="/web/fundamentals/app-install-banners/native">приглашение для установки собственного приложения</a> .

## Показать диалог добавления на главный экран {: #trigger}

<figure class="attempt-right"><img src="../../../en/fundamentals/app-install-banners/images/a2hs-dialog-g.png" alt="Диалог добавления на главный экран на Android"><figcaption> Диалог добавления на главный экран на Android </figcaption></figure>

Чтобы отобразить диалоговое окно «Добавить на главный экран», вам необходимо:

1. Прослушайте событие `beforeinstallprompt`
2. Уведомите пользователя, что ваше приложение может быть установлено с помощью кнопки или другого элемента, который сгенерирует событие жеста пользователя.
3. Показать приглашение, вызвав `prompt()` для сохраненного события `beforeinstallprompt` .

<div class="clearfix"></div>

Примечание. В Chrome 67 и более ранних версиях отображался баннер «Добавить на главный экран». Это было удалено в Chrome 68.

### Слушайте перед `beforeinstallprompt`

Если [критерии](#criteria) добавления на главный экран удовлетворены, Chrome `beforeinstallprompt` событие `beforeinstallprompt` , которое вы можете использовать, чтобы указать, что ваше приложение можно «установить», а затем предложит пользователю установить его.

Когда событие `beforeinstallprompt` , сохраните ссылку на событие и обновите свой пользовательский интерфейс, чтобы указать, что пользователь может добавить ваше приложение на свой домашний экран.

```
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  // Prevent Chrome 67 and earlier from automatically showing the prompt
  e.preventDefault();
  // Stash the event so it can be triggered later.
  deferredPrompt = e;
});
```

### Сообщите пользователю, что ваше приложение может быть установлено

Лучший способ уведомить пользователя о том, что ваше приложение может быть установлено, - добавить кнопку или другой элемент в ваш пользовательский интерфейс. **Не показывайте вставку всей страницы или другие элементы, которые могут раздражать или отвлекать.**

<pre class="prettyprint">window.addEventListener ('beforeinstallprompt', (e) => {// Предотвращение автоматического отображения приглашения Chrome 67 и более ранних версий e.preventDefault (); // Сохранение события, чтобы его можно было запустить позже. deferredPrompt = e; <strong>// Обновление пользовательского интерфейса уведомляет пользователя, которого он может добавить на домашний экран btnAdd.style.display = 'block';</strong> });</pre>

Успех: вы можете подождать, прежде чем показывать подсказку пользователю, чтобы не отвлекать их от того, что они делают. Например, если пользователь находится в процессе извлечения или создает свою учетную запись, дайте ему завершить это, прежде чем прерывать его с приглашением.

### Показать подсказку

Чтобы отобразить подсказку добавления на главный экран, вызовите `prompt()` для сохраненного события в жесте пользователя. Появится модальное диалоговое окно с просьбой добавить приложение на домашний экран.

Затем прослушайте обещание, возвращаемое свойством `userChoice` . Обещание возвращает объект с `outcome` свойством после того, как приглашение было показано, и пользователь ответил на него.

```
btnAdd.addEventListener('click', (e) => {
  // hide our user interface that shows our A2HS button
  btnAdd.style.display = 'none';
  // Show the prompt
  deferredPrompt.prompt();
  // Wait for the user to respond to the prompt
  deferredPrompt.userChoice
    .then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the A2HS prompt');
      } else {
        console.log('User dismissed the A2HS prompt');
      }
      deferredPrompt = null;
    });
});
```

Вы можете только вызвать `prompt()` для отложенного события один раз. Если пользователь отклонит его, вам нужно будет подождать, пока на следующей странице навигации не `beforeinstallprompt` событие `beforeinstallprompt` .

<< _ mini-info-bar.md >>

## Обратная связь {: .hide-from-toc}

{% include "web / _shared / полезно.html"%}

<div class="clearfix"></div>

## Определите, было ли приложение успешно установлено {: #appinstalled}

Чтобы определить, было ли приложение успешно добавлено на домашний экран пользователя *после* того, *как* он принял приглашение, вы можете прослушать событие `appinstalled` .

```
window.addEventListener('appinstalled', (evt) => {
  app.logEvent('a2hs', 'installed');
});
```

## Определение, запущено ли ваше приложение с домашнего экрана {: # detect-mode}

### медиа-запрос в `display-mode`

Медиа-запрос в `display-mode` позволяет применять стили в зависимости от того, как было запущено приложение, или определять, как оно запускалось с помощью JavaScript.

Чтобы применить другой цвет фона для приложения выше при запуске с домашнего экрана с помощью `"display": "standalone"` , используйте условный CSS:

```
@media all and (display-mode: standalone) {
  body {
    background-color: yellow;
  }
}
```

Также возможно определить, является ли режим `display-mode` автономным от JavaScript:

```
if (window.matchMedia('(display-mode: standalone)').matches) {
  console.log('display-mode is standalone');
}
```

### Сафари

Чтобы определить, было ли приложение запущено в `standalone` режиме в Safari, вы можете использовать JavaScript для проверки:

```
if (window.navigator.standalone === true) {
  console.log('display-mode is standalone');
}
```

## Обновление иконки и названия вашего приложения

### Android

В Android при запуске WebAPK Chrome проверит установленный в данный момент манифест по действующему манифесту. Если требуется обновление, оно будет [поставлено в очередь и будет обновлено](/web/fundamentals/integration/webapks#update-webapk) после того, как устройство будет подключено и подключено к WiFi.

### рабочий стол

На рабочем столе манифест не обновляется автоматически, но это запланировано на будущее обновление.

## Протестируйте свое дополнение к опыту на главном экране {: #test}

Вы можете вручную вызвать событие `beforeinstallprompt` с помощью Chrome DevTools. Это позволяет увидеть пользовательский опыт, понять, как работает поток, или отладить поток. Если [критерии PWA](#pwa-criteria) не выполнены, Chrome выдаст исключение в консоли, и событие не будет запущено.

Осторожно: в Chrome несколько отличается процесс установки для настольных и мобильных устройств. Хотя инструкции похожи, тестирование на мобильных устройствах <b>требует</b> удаленной отладки; без этого Chrome будет использовать процесс установки рабочего стола.

### Chrome для Android

1. Откройте сеанс [удаленной отладки](/web/tools/chrome-devtools/remote-debugging/) на вашем телефоне или планшете.
2. Перейти на панель **приложений** .
3. Перейдите на вкладку « **Манифест** ».
4. Нажмите **Добавить на главный экран**

### Chrome OS, Linux или Windows

1. Открыть Chrome DevTools
2. Перейти на панель **приложений** .
3. Перейдите на вкладку « **Манифест** ».
4. Нажмите **Добавить на главный экран**

### Будет ли `beforeinstallprompt` быть уволен?

Самый простой способ проверить, будет ли `beforeinstallprompt` событие `beforeinstallprompt` , - использовать [Lighthouse](/web/tools/lighthouse/) для аудита вашего приложения и проверки результатов теста « [Пользователь может быть предложено установить»](/web/tools/lighthouse/audits/install-prompt) .
